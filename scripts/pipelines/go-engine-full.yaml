# Go Engine Full Pipeline
# Runs all 3 phases: implement (Codex) → discover → triage → fix (Claude)

name: go-engine-full
description: Complete Go engine rewrite - all 3 phases with bug review cycles

nodes:
  # ═══════════════════════════════════════════════════════════════
  # PHASE 1: Core Engine (MVP)
  # ═══════════════════════════════════════════════════════════════
  - id: phase1-implement
    stage: codex-work
    runs: 25
    context: |
      PHASE 1: Core Engine MVP

      IMPORTANT: Use beads labeled `pipeline/phase1` (NOT pipeline/${SESSION_NAME})
      Run: bd ready --label=pipeline/phase1
      Claim: bd update <id> --status=in_progress --label=pipeline/phase1
      Close: bd close <id>

      Commit after each task. Tests: go test ./...

  - id: phase1-discover
    stage: bug-discovery
    runs: 5
    inputs:
      from: phase1-implement
    context: |
      Spawn these review agents in parallel via Task tool:
      - compound-engineering:review:architecture-strategist
      - compound-engineering:review:security-sentinel
      - compound-engineering:review:performance-oracle
      - compound-engineering:review:code-simplicity-reviewer
      - compound-engineering:review:pattern-recognition-specialist
      Focus on Go code in cmd/, pkg/, internal/. Document bugs in progress file.

  - id: phase1-triage
    stage: bug-triage
    runs: 3
    inputs:
      from: phase1-discover

  - id: phase1-fix
    stage: ralph
    runs: 10
    inputs:
      from: phase1-triage
    context: |
      Fix bugs created by bug-triage. Use beads labeled: pipeline/go-engine
      Run: bd ready --label=pipeline/go-engine
      Commit after each fix: git add -A && git commit -m "fix: [bead-id] - description"
      Tests: go test ./...

  # ═══════════════════════════════════════════════════════════════
  # PHASE 2: Full Parity
  # ═══════════════════════════════════════════════════════════════
  - id: phase2-implement
    stage: codex-work
    runs: 25
    inputs:
      from: phase1-fix
    context: |
      PHASE 2: Full Parity

      IMPORTANT: Use beads labeled `pipeline/phase2` (NOT pipeline/${SESSION_NAME})
      Run: bd ready --label=pipeline/phase2
      Claim: bd update <id> --status=in_progress --label=pipeline/phase2
      Close: bd close <id>

      Commit after each task. Tests: go test ./...

  - id: phase2-discover
    stage: bug-discovery
    runs: 5
    inputs:
      from: phase2-implement
    context: |
      Spawn these review agents in parallel via Task tool:
      - compound-engineering:review:architecture-strategist
      - compound-engineering:review:security-sentinel
      - compound-engineering:review:performance-oracle
      - compound-engineering:review:code-simplicity-reviewer
      - compound-engineering:review:pattern-recognition-specialist
      Focus on Phase 2: termination strategies, parallel blocks, session locking.

  - id: phase2-triage
    stage: bug-triage
    runs: 3
    inputs:
      from: phase2-discover

  - id: phase2-fix
    stage: ralph
    runs: 10
    inputs:
      from: phase2-triage
    context: |
      Fix bugs created by bug-triage. Use beads labeled: pipeline/go-engine
      Run: bd ready --label=pipeline/go-engine
      Commit after each fix: git add -A && git commit -m "fix: [bead-id] - description"
      Tests: go test ./...

  # ═══════════════════════════════════════════════════════════════
  # PHASE 3: SDK & Hooks
  # ═══════════════════════════════════════════════════════════════
  - id: phase3-implement
    stage: codex-work
    runs: 25
    inputs:
      from: phase2-fix
    context: |
      PHASE 3: SDK & Hooks

      IMPORTANT: Use beads labeled `pipeline/phase3` (NOT pipeline/${SESSION_NAME})
      Run: bd ready --label=pipeline/phase3
      Claim: bd update <id> --status=in_progress --label=pipeline/phase3
      Close: bd close <id>

      Commit after each task. Tests: go test ./...

  - id: phase3-discover
    stage: bug-discovery
    runs: 5
    inputs:
      from: phase3-implement
    context: |
      Spawn these review agents in parallel via Task tool:
      - compound-engineering:review:architecture-strategist
      - compound-engineering:review:security-sentinel
      - compound-engineering:review:performance-oracle
      - compound-engineering:review:code-simplicity-reviewer
      - compound-engineering:review:pattern-recognition-specialist
      Focus on Phase 3: hook system, SDK APIs, pause/resume, event channels.

  - id: phase3-triage
    stage: bug-triage
    runs: 3
    inputs:
      from: phase3-discover

  - id: phase3-fix
    stage: ralph
    runs: 10
    inputs:
      from: phase3-triage
    context: |
      Fix bugs created by bug-triage. Use beads labeled: pipeline/go-engine
      Run: bd ready --label=pipeline/go-engine
      Commit after each fix: git add -A && git commit -m "fix: [bead-id] - description"
      Tests: go test ./...
      This completes the Go engine rewrite.
